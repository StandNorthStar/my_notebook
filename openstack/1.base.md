虚拟化:

TLB  虚拟机编号   , 虚拟机切换tag标签避免频繁清写TLB提高TLB缓存命中率

驱动只内核调用.   虚拟机内核和驱动打交道

虚拟机发送报文:

```
   先通过虚拟网卡, 先送给kvm , 然后叫给内核. 处理完成在返回给kvm

   用户空间- 内核

   把驱动程序做成系统调用, vm直接调用.

           明白自己是一个虚拟机, 这种叫半虚拟化\(性能好\) , 跟硬件打交道比较快.

           虚拟机
```

CPU虚拟化:

```
  CPU不支持虚拟化: 模拟特权指令;   模拟

  CPU支持硬件虚拟化: VMM运行ring -1 , 而GuestOS运行在ring 0;  HVM\(硬件辅助\)
```

para-virtualization: 半虚拟化, pv

pv和HVM整合:

```
    os把特权指令直接给vm系统调用 \(hypervisor call 只给虚拟化调用,不给进程.\)

    运行在半虚拟化环境下, 需要修改内核. 所以不能支持Windows

    cpu, io, memroy ;   
    pv on HVM \(不需要前面的CPU虚拟化了, 因为CPU可以自己提供虚拟化指令\)
    IO虚拟化:
       半虚拟化: vm的虚拟网卡- 驱动- 物理驱动  [emulated]
       IO透传技术: vm的虚拟网卡直接使用物理的设备  (有一定的管理接口)
           需要足够的硬件才能使用透传技术.
```



